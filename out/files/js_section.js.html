<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js\section.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/bts.Preloader.html">bts.Preloader</a></li>
                                <li><a href="../classes/bts.Section.html">bts.Section</a></li>
                                <li><a href="../classes/bts.Ship.html">bts.Ship</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/BattleShips.html">BattleShips</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js\section.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * @module BattleShips
 */
this.bts = this.bts || {};

(function () {
	&#x27;use strict&#x27;;
/**
 * @namespace bts
 * @class bts.Section
 * @extends {createjs.Container}
 * @constructor
 */
	let Section = function (row, line) {
		// :properties
		this.row = row;
		this.line = line;

		this.initialize();
	}

	let p = Section.prototype = new createjs.Container();
	p.Container_initialize = p.initialize;
	// :methods
	/**
	 * Initialize the section
	 *
	 * @method init
	 */
	p.initialize = function () {
		this.Container_initialize();
		this.drawSection(&#x27;#fff&#x27;);
	}
 
	p.drawSection= function (fillColor){
		let section = new createjs.Shape();

		section.graphics
			.beginStroke(&#x27;#000&#x27;)
			.beginFill(fillColor)
			.drawRect(
				bts.SCORE_BOARD_WIDTH + this.row*bts.SECTION_SIZE, 
				this.line*bts.SECTION_SIZE, bts.SECTION_SIZE, bts.SECTION_SIZE
			);
		section.alpha = 0.4;
		this.occupied = false;
		this.name = this.line + &#x27;-&#x27; + this.row;

		this.addChild(section);
	}

	p.addEventListeners = function(){
		this.cursor = &#x27;pointer&#x27;;
		this.on(&#x27;click&#x27;, this.onSectionClick);
	}

	p.onSectionClick = function(){
		if(this.checkIfSectionInOponentField()){
			this.reveal();
			this.removeAllEventListeners();
			this.cursor = &#x27;default&#x27;;

			bts.socket.emit(&#x27;hit&#x27;, { row: this.row - 6, line: this.line});
			if(!bts.finishGame){
				bts.showMessage(&#x27;Oponent\&#x27;s turn&#x27;);
			}
		}
	}

	p.checkIfSectionInOponentField = function(){
		if(this.row &gt;= 6 &amp;&amp; this.row &lt; 12){
			return true;
		}
		else false;
	}

	p.reveal = function(){
		if(this.children[0].occupied == true){
			this.explode();
			this.removeFromShipsOccupiedSections();
			this.drawSection(&#x27;#db2323&#x27;);
		}else{
			this.drawSection(&#x27;#333&#x27;);
		}
	}

	p.explode = function () {
		let explosionSpritesheet = new createjs.SpriteSheet(
		{
			images : [bts.queue.getResult(&#x27;explosion&#x27;)],
			frames: bts.explosionSpritesheetData.frames,
			animations: bts.explosionSpritesheetData.animations
		});

		let explosion = new createjs.Sprite(explosionSpritesheet, &#x27;explode&#x27;);

		explosion.x = this.children[0].graphics.command.x;
		explosion.y = this.children[0].graphics.command.y;
		explosion.on(&quot;animationend&quot;, function(e){
			bts.stage.removeChild(e);
			console.log(&#x27;explosion removed&#x27;);
		});

		bts.stage.addChild(explosion);
	}

	p.removeFromShipsOccupiedSections =  function (){
		bts.stage.children.find(element =&gt; {
			if(element instanceof bts.Ship &amp;&amp; !element.sunk){
				let foundSection = element.occupiedSections.find(section =&gt; {
					if(section.row == this.row &amp;&amp; section.line == this.line){
						return true;
					}
					return false;
				});
				if(foundSection){
					element.occupiedSections = element.occupiedSections.filter(section =&gt; {
						if(section.row == this.row &amp;&amp; section.line == this.line){
							return false;
						}
						return true;
					});
					if(element.occupiedSections.length == 0 &amp;&amp; !element.sunk){
						bts.decreasePlayerShips(this);
						element.revealShip();
					}
				}
				
			}
		});
	}

	/**
	 * Get section by given row and line.
	 *
	 * @method getSectionByPosition
	 * @param {Number} row 
	 * @param {Number} line 
	 * @return {Section} 
	 */
	bts.getSectionByPosition = function(row,line){
		return  bts.stage.getChildByName(&#x27;field&#x27;).children[line*bts.ROWS + row];
	}

	bts.getAllOccupiedSections = function () {
		let field = bts.stage.getChildByName(&#x27;field&#x27;);
		let occupiedSections = [];

		occupiedSections = field.children.filter( section =&gt; section.children[0].occupied == true);

		return occupiedSections;
	}

	/**
	 * Checks if the position is free for the ship to be placed in
	 * 
	 * @method isPositionOccupied
	 * @param {Object} position 
	 * @return {Boolean} 
	 */
	bts.isPositionOccupied = function (position){
		let occupiedInPos, allOccupied = bts.getAllOccupiedSections();
		occupiedInPos = allOccupied.filter(function(section){
			if(section.line &gt;= position.line &amp;&amp; section.line &lt; position.line + position.occupiedLines){
				if(section.row &gt;= position.row &amp;&amp; section.row &lt; position.row + position.occupiedRows){
					return true;
				}
			}
			return false;
		});

		if(occupiedInPos.length == 0){ 
			return false;
		}
		return true;
	}

	// add to namespace
	bts.Section = Section;
}())
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
